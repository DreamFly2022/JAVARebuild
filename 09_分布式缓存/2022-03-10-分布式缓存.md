# 分布式缓存

[toc]

## 一、缓存

从为什么有缓存说起：从数据的使用说起。

两种常见的缓存：本地缓存、远程缓存。

再到常见的缓存策略，随后讲Redis会详细再讲缓存策略。

最后一个话题是（面试经常会问）——缓存世界的三大难题：缓存的穿透、缓存的击穿、缓存的雪崩。

学会背后的东西：技术在变，但背后的思想和方法永远不会变。

## 二、从数据的使用说起

### 2.1 我们把数据的使用频率和方式分个类

我们的业务系统越来越复杂，数据量越来越大，这样我们就可以对我们的业务数据进行 不同程序的分类，之前提到过，我们通过使用频率可以把数据分为：热数据、冷数据、温数据、冰数据。

####（1）通过使用频率，我们还可以采用有一点点差异的方式进行分类：

- 静态数据：类似于字典表，长期不会变。

  比如性别数据。

- 准静态数据：变化频率很低

  比如：部门结构设置，全国行政区划数据（平均一年变一次）等

- 中间状态数据：一些计算的可复用的中间数据。一般不是原始数据，通过基础数据计算出来的中间状态的结果

  我们的流水数据是原始数据，我们可以根据流水数据计算出一个大的店铺的某个品类交易了多少钱。

  甚至我们可以说是，一个业务方法调用后返回的结构。这样的数据是中间状态数据。

  一般情况下，丢了无所谓，因为可以重新计算出来。但有时候计算的成本比较大。

  举例，变量副本：前面讲的JVM中的变量，每个线程都有其副本，它也是一个中间数据。

  举例，配置中心：配置中心可以配置一个本地的缓存文件夹，这样就可以放一些缓存的文件，把从配置中心拉取到的配置在本地缓存一份。如果配置中心宕机了，可以先用本地的。

- 变化中的动态数据（本文中不具体讲）

####（2）这些需要缓存的数据特点：

- 热数据：虽然变动少，但它们是热数据，使用频率高。

  比如字典表，几乎所有的业务都在使用它们。

- 读写比大："读（n）/写（1）"非常大。读的频率>>写的频率

这些数据就特别适合做缓存。

####（3）什么是缓存？

从广义上来讲，为了**加速**数据处理（降低数据库的压力）,让业务更快访问的**临时存放冗余数据**，都是缓存。

> 缓存本质上相当于原始数据的某种快照，如果跟原始数据一致的快照，那他就是对等快照。如果是中间状态，都是它加工映射过的快照。

狭义上，现在我们一般在分布式系统里把缓存到内存的数据叫内存缓存，有时候我们简称它为缓存。

> 放到内存中，加速访问，不走网络IO，磁盘IO，这些IO等慢操作，直接从内存里拿。

再狭义些，有些人把缓存称为Redis。

### 2.2  缓存无处不在

缓存比我们平时在Java分布式系统下的语义要大得多：

场景一：

比如：内存本身可以看作是CPU和磁盘之间的缓存。因为CPU太快了，磁盘太慢了，内存的速度处于CPU和磁盘之间。

当CPU全速跑的时候，内存也会跟不上，这个时候就出现了CPU的缓存：L1&L2 cache。

场景二：

在网络处理、数据库引擎中有各种Buffer，这些Buffer我们称之为缓冲区，这些缓冲区就是用来放数据的，也是缓存。

场景三：

甚至在更早的时候，GUI画界面中有一个Double Buffer（双缓存），比如要画一个图，这个图需要用到10万个点，如果每画一个点就渲染一次，就会把页面卡死。优化的方案是：在内存区域，我们每1000次把点连起来。

场景四：

包括三大前端框架，用到虚拟DOM。





