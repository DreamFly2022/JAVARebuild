# 进阶实战-MySQL分布式事务

[toc]

## 一、列举常见的分布式事务

1、（选做）列举常见的分布式事务，简单分析其使用场景和优缺点。 

- 强一致性事务（XA）

  特点：像单机事务一样操作，由RM(本地资源管理器)、TM(全局事务管理器)、AP(应用程序)，三部分组成。

  场景：要求强一致性，比如金融业务。

  优点：保证强一致性；

  缺点：效率低。

  ```
  （1）同步阻塞问题
  1. 使用XA比不使用XA的性能低很多。
  2. 在XA下，如果真要保证现有的隔离级别，那么当XA在执行的时候，需要将当前会话的隔离级别改为 SERIALIZABLE。
  
  查询当前事务的隔离级别：
  mysql> show variables like '%iso%';
  +-----------------------+-----------------+
  | Variable_name         | Value           |
  +-----------------------+-----------------+
  | transaction_isolation | REPEATABLE-READ |
  | tx_isolation          | REPEATABLE-READ |
  +-----------------------+-----------------+
  2 rows in set (0.01 sec)
  
  （2）单点故障
  要考虑对 TM（全局事务管理器）实现高可用。
  （3）数据不一致
  极端情况下，数据不一致，需要人工干预。
  ```

- 柔性事务：

  特点：不用事务，通过业务侧补充冲正。

  场景：电商业务。

  优点：效率高。

  缺点：短时间段内，数据会有不一致的情况。

## 二、Atomikos  XA

2、（必做）基于hmily TCC或ShardingSphere的Atomikos XA实现一个简单的分布式 事务应用demo（二选一），提交到github。 

## 三、narayana XA

3、（选做）基于ShardingSphere narayana XA实现一个简单的分布式事务demo。 

## 四、seata

4、（选做）基于seata框架实现TCC或AT模式的分布式事务demo。 

## 五、设计实现一个简单的XA分布式事务框架

5、（选做☆）设计实现一个简单的XA分布式事务框架demo，只需要能管理和调用2 个MySQL的本地事务即可，不需要考虑全局事务的持久化和恢复、高可用等。 

## 六、设计实现一个TCC分布式事务框架的简单

6、（选做☆）设计实现一个TCC分布式事务框架的简单Demo，需要实现事务管理器， 不需要实现全局事务的持久化和恢复、高可用等。 

## 七、设计实现一个AT分布式事务框架的简单

7、（选做☆）设计实现一个AT分布式事务框架的简单Demo，仅需要支持根据主键id 进行的单个删改操作的SQL或插入操作的事务。